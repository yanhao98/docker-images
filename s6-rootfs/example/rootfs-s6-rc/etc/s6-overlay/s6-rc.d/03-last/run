#!/command/with-contenv sh
# shellcheck shell=sh

check_port() {
  echo "ğŸ”„ æ£€æŸ¥ $1:$2 æ˜¯å¦å¯ç”¨..."
  host=$1
  port=$2
  nc -z $host $port >/dev/null 2>&1
}

echo "ğŸš€ å¯åŠ¨ AdGuardHome..."
/command/s6-svc -u /run/service/01-adguardhome

# Wait for AdGuardHome to be fully available
while ! check_port 127.0.0.1 53; do
  sleep 1
done
echo "ğŸ‰ AdGuardHome å·²å¯åŠ¨ã€‚"


echo "ğŸš€ å¯åŠ¨ Caddy..."
/command/s6-svc -u /run/service/02-caddy

# Wait for Caddy to be fully available
while ! check_port 127.0.0.1 80; do
  sleep 1
done
echo "ğŸ‰ Caddy å·²å¯åŠ¨ã€‚"


exec tail -f /dev/null
